<!--
  to do:

user stories:
  + can add, subtract, multiply and divide two numbers.
  + can clear the input field with a clear button.
  + can keep chaining mathematical operations together until I hit the equal button, and the calculator will tell me the correct output.
-->
<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="styles/master.css.scss" rel="stylesheet" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <title>calculatorJS</title>
</head>
<body>
  <div class="container">
  <div class="main"> 
    <div class="black-top"></div>
      <div class="display">
        <br /><br />
        <span class="model">CASIO pocket-8S</span><br />
        <span class="title"><small>ELECTRONIC CALCULATOR</small></span>
        <br /><br /><br />
        <span class="results">0</span>
        <br /><br />
        <span class="mem"><small>0</small></span>
      </div> <!-- end of display -->
      <div id="buttons">
        <button id="solar" value=''>o |||</button>
        <button id="ac" value=''>AC</button>
        <button id="c" value=''>C</button>
        <button id="percent" value=''>%</button><br />
        <button id="seven" value='7'>7</button>
        <button id="eight" value='8'>8</button>
        <button id="nine" value='9'>9</button>
        <button id="divide" value='/'>/</button><br />
        <button id="four" value='4'>4</button>
        <button id="five" value='5'>5</button>
        <button id="six" value='6'>6</button>
        <button id="multiply"value='*'>x</button><br />
        <button id="one" value='1'>1</button>
        <button id="two" value='2'>2</button>
        <button id="three" value='3'>3</button>
        <button id="sub" value='-'>-</button><br />
        <button id="zero" value='0'>0</button>
        <button id="deci" value='.'>.</button>
        <button id="equals" value=''>=</button>
        <button id="add" value='+'>+</button>   
      </div> <!-- end of buttons -->   
      <div class="black-bottom"></div>  
    </div> <!-- end of main --> 
  </div><!-- end of container -->
</body>
</html>

<script>
  $(document).ready(function() {
    
    var defaultVal = 0;
    var entry = '';
    var current = 0;
    var answer = '';

    $('button').on("click", function() {
      entry += $(this).attr("value");
      entry = entry.slice(0, 14); // caps digits
      
      if(entry.includes("//") || entry.includes("**") || entry.includes("--") || entry.includes("++") || entry.includes("==") || entry.includes("..") || entry.includes("%%") ) {
        
        opCheck();
      }
      
      showCurrent();
      // console.log("entry: " + entry);   
    });
    
    $('#equals').on("click", function() {      
      equals();
      entry = answer;
    });

    $('#ac').on("click", function() { 
      allClear();
    });

    $('#c').on("click", function() {
      clearButton(); 
    })

    $('#solar').on("click", function() {
      $('.mem').html("solar powered");
    })

    $('#percent').on("click", function() {
      getPercent();  
    })

    function equals() { 
      answer = current;
      // console.log(answer);
      $('.mem').html(answer);
    }

    function showCurrent() {
      current = eval(entry);
      var rounded = Math.round(current * 100) / 100;
    
      $('.results').html(rounded);
      $('.mem').html(entry);
    }

    function allClear() {
      entry = '';    
      $('.results').html(defaultVal);
      $('.mem').html(defaultVal);
    }

    function clearButton() {
      var newEntry = entry.substr(0, entry.length-1);
      //console.log(newEntry);
      entry = newEntry;
      // console.log(entry);
      $('.mem').html(entry);

      if(entry.length == 0) {
        $('.results').html(defaultVal);
        $('.mem').html(defaultVal);
      }
    }

    function opCheck() { 
      var filter = entry.replace(/[^A-Za-z0-9_]/, '');
      //console.log(filter);
       entry = filter;
      // console.log(entry);
       $('.mem').html(entry);  
    }

    function getPercent() {
      var convertToDecimal = entry.substr(-2);
        if(convertToDecimal < 10) {
          convertToDecimal = '0.0' + convertToDecimal;
        }
        else {
          convertToDecimal = '0.' + convertToDecimal;
        }
      
      // console.log(convertToDecimal);

      var edit = entry.substr(0, entry.length-2);
      // console.log("edit: " + edit);

      if(edit.includes('*')) {
        var updateMath = edit + convertToDecimal;
        entry = updateMath;
        // console.log(entry);
      }
      else if(edit.includes('+') || edit.includes('-')) {
        var multFirst = entry.substr(0, entry.length-3);
        updateMath = multFirst * convertToDecimal;
        $('.results').html(updateMath);
        updateMath = edit + updateMath;
        // console.log("update after calc: " + updateMath);
        entry = updateMath;
        // console.log(entry);
      }
      else {
        $('.results').html('error');
      }  
    }

  }) // end of doc
</script>